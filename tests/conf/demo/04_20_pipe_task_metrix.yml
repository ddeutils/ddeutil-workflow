ingest_multiple_system:
  type: pipeline.Pipeline
  params:
    source: str
    target: str
  jobs:
    multiple-system:
      strategy:
        matrix:
          table: ['customer', 'sales']
          system: ['csv']
          partition: [1, 2, 3]
        exclude:
          - table: customer
            system: csv
            partition: 1
          - table: sales
            partition: 3
        include:
          - table: customer
            system: csv
            partition: 4
      stages:
        - name: Extract & Load Multi-System
          uses: tasks/el-${{ matrix.system }}-to-parquet@polars-dir
          id: ${{ matrix.table }}-${{ matrix.partition }}
          with:
            source:
              conn: ${{ params.source }}
              table: ${{ matrix.table }}
            sink:
              conn: ${{ params.target }}
              endpoint: /raw/${{ matrix.table }}_${{ matrix.system }}

        - name: End Stage
          id: end-stage
          run: |
            passing_value: int = 10
